
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ScheduledTask</title>
    
    <meta name="author" content="Lucas AllanJerry DAntonio">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">Concurrent-ruby</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/about/index.html">About</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/documentation/index.html">Documentation</a></li>
      	
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        
<div class="page-header">
  <h1>ScheduledTask </h1>
</div>

<div class="row-fluid">
  <div class="span12">
    <h1 id="im_late_for_a_very_important_date">I’m late! For a very important date!</h1>

<p><code>ScheduledTask</code> is a close relative of <code>Concurrent::Future</code> but with one important difference. A <code>Future</code> is set to execute as soon as possible whereas a <code>ScheduledTask</code> is set to execute at a specific time. This implementation is loosely based on Java’s <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ScheduledExecutorService.html">ScheduledExecutorService</a>.</p>

<h2 id="scheduling">Scheduling</h2>

<p>The scheduled time of task execution is set on object construction. The first parameter to <code>#new</code> is the task execution time. The time can be a numeric (floating point or integer) representing a number of seconds in the future or it can ba a <code>Time</code> object representing the approximate time of execution. Any other value, a numeric equal to or less than zero, or a time in the past will result in an <code>ArgumentError</code> being raised.</p>

<p>The constructor can also be given zero or more processing options. Currently the only supported options are those recognized by the <a href="https://github.com/jdantonio/concurrent-ruby/blob/master/md/dereferenceable.md">Dereferenceable</a> module.</p>

<p>The final constructor argument is a block representing the task to be performed at the scheduled time. If no block is given an <code>ArgumentError</code> will be raised.</p>

<h3 id="states">States</h3>

<p><code>ScheduledTask</code> mixes in the <a href="https://github.com/jdantonio/concurrent-ruby/blob/master/md/obligation.md">Obligation</a> module thus giving it “future” behavior. This includes the expected lifecycle states. <code>ScheduledTask</code> has one additional state, however. While the task (block) is being executed the state of the object will be <code>:in_progress</code>. This additional state is necessary because it has implications for task cancellation.</p>

<h3 id="cancellation">Cancellation</h3>

<p>A <code>:pending</code> task can be cancelled using the <code>#cancel</code> method. A task in any other state, including <code>:in_progress</code>, cannot be cancelled. The <code>#cancel</code> method returns a boolean indicating the success of the cancellation attempt. A cancelled <code>ScheduledTask</code> cannot be restarted. It is immutable.</p>

<h2 id="obligation_and_observation">Obligation and Observation</h2>

<p>The result of a <code>ScheduledTask</code> can be obtained either synchronously or asynchronously. <code>ScheduledTask</code> mixes in both the <a href="https://github.com/jdantonio/concurrent-ruby/blob/master/md/obligation.md">Obligation</a> module and the <a href="http://ruby-doc.org/stdlib-2.0/libdoc/observer/rdoc/Observable.html">Observable</a> module from the Ruby standard library. With one exception <code>ScheduledTask</code> behaves identically to <a href="https://github.com/jdantonio/concurrent-ruby/blob/master/md/future.md">Concurrent::Future</a> with regard to these modules.</p>

<p>Unlike <code>Future</code>, however, an observer added to a <code>ScheduledTask</code> <em>after</em> the task operation has completed will <em>not</em> receive notification. The reason for this is the subtle but important difference in intent between the two abstractions. With a <code>Future</code> there is no way to know when the operation will complete. Therefore the <em>expected</em> behavior of an observer is to be notified. With a <code>ScheduledTask</code> however, the approximate time of execution is known. It is often explicitly set as a constructor argument. It is always available via the <code>#schedule_time</code> attribute reader. Therefore it is always possible for calling code to know whether the observer is being added prior to task execution. It is also easy to add an observer long before task execution begins (since there is never a reason to create a scheduled task that starts immediately). Subsequently, the <em>expectation</em> is that the caller of <code>#add_observer</code> is making the call within an appropriate time.</p>

<h2 id="examples">Examples</h2>

<p>Successful task execution using seconds for scheduling:</p>

<pre class="ruby"><code class="ruby">
require 'concurrent'

task = Concurrent::ScheduledTask.new(2){ 'What does the fox say?' }
task.pending?      #=&gt; true
task.schedule_time #=&gt; 2013-11-07 12:20:07 -0500

# wait for it...
sleep(3)

task.pending?   #=&gt; false
task.fulfilled? #=&gt; true
task.rejected?  #=&gt; false
task.value      #=&gt; 'What does the fox say?'
</code></pre>

<p>Failed task execution using a <code>Time</code> object for scheduling:</p>

<pre class="ruby"><code class="ruby">
require 'concurrent'

t = Time.now + 2
task = Concurrent::ScheduledTask.new(t){ raise StandardError.new('Call me maybe?') }
task.pending?      #=&gt; true
task.schedule_time #=&gt; 2013-11-07 12:22:01 -0500

# wait for it...
sleep(3)

task.pending?   #=&gt; false
task.fulfilled? #=&gt; false
task.rejected?  #=&gt; true
task.value      #=&gt; nil
task.reason     #=&gt; #&lt;StandardError: Call me maybe?&gt; 
</code></pre>

<p>Task execution with observation:</p>

<pre class="ruby"><code class="ruby">
require 'concurrent'

observer = Class.new{
  def update(time, value, reason)
    puts &quot;The task completed at #{time} with value '#{value}'&quot;
  end
}.new

task = Concurrent::ScheduledTask.new(2){ 'What does the fox say?' }
task.add_observer(observer)
task.pending?      #=&gt; true
task.schedule_time #=&gt; 2013-11-07 12:20:07 -0500

# wait for it...
sleep(3)

#&gt;&gt; The task completed at 2013-11-07 12:26:09 -0500 with value 'What does the fox say?'
</code></pre>

<h2 id="copyright">Copyright</h2>

<p><em>Concurrent Ruby</em> is Copyright © 2013 <a href="https://twitter.com/jerrydantonio">Jerry D’Antonio</a>. It is free software and may be redistributed under the terms specified in the LICENSE file.</p>

<h2 id="license">License</h2>

<p>Released under the MIT license.</p>

<p>http://www.opensource.org/licenses/mit-license.php</p>

<blockquote>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy<br />of this software and associated documentation files (the “Software”), to deal<br />in the Software without restriction, including without limitation the rights<br />to use, copy, modify, merge, publish, distribute, sublicense, and/or sell<br />copies of the Software, and to permit persons to whom the Software is<br />furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in<br />all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR<br />IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,<br />FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE<br />AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER<br />LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,<br />OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN<br />THE SOFTWARE.</p>
</blockquote>
  </div>
</div>


      </div>
      <hr>
      <footer>
      </footer>

    </div>

    
  </body>
</html>

